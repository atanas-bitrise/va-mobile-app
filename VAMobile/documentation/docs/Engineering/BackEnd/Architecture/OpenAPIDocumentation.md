# OpenAPI Documentation

## OpenAPI creation and artefact generation

The mobile backend team documents its API endpoints using [OpenAPI3](https://swagger.io/specification/). The documentation is recorded in a yaml file, which is converted to (HTML)[VAMobile/documentation/docs/Engineering/BackEnd/API/index.md] and JSON via the `modules/mobile/docs/generate_static_docs.sh` script. Developers must run that script each time they change the yaml to ensure that the documents are up to date.

## Setup

Developers will need to install [redocly](https://redocly.com/docs/cli/installation#install-globally) in order to run the `generate_static_docs` script.

## Using OpenAPI in RSpec

The backend team uses the [committee-rails gem](https://github.com/willnet/committee-rails) to tie our documentation and specs together. This gem should be used in request specs to validate requests and responses against the JSON file generated by the generate_static_docs script. To add it to a request spec, simply call the method `assert_schema_conform(expected_status)`. This will use the uri path from the `request` object and the expected status (e.g., 200) to look up which schema the request should match. It will then validate that the `response.body` object matches that schema.

## Limitations

These tests run against VCR cassettes we've either recorded or been given. These cassettes will not cover all cases. The data types used in the cassettes will almost certainly be consistent and stable, but it can be more difficult to know whether something might be nullable. The frontend will typically treat any non-required properties as nullable out of caution.

It's also possible for cassettes to become out of date, which can cause drift between our specs/documentation and reality. This is why it's important to have models that validate the data types we receive and well defined serializers to ensure that additional properties are not passed through unintentionally. To that point, most objects in the schema should have `additionalProperties: false` to confirm that we're not passing unintended properties through in nested objects.