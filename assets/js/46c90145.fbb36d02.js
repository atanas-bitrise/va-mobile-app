"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[6965],{55433:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var a=t(58168),i=(t(96540),t(15680));t(41873);const r={title:"Maintenance Windows"},o=void 0,s={unversionedId:"Engineering/BackEnd/Features/MaintenanceWindows",id:"Engineering/BackEnd/Features/MaintenanceWindows",title:"Maintenance Windows",description:"Overview",source:"@site/docs/Engineering/BackEnd/Features/MaintenanceWindows.md",sourceDirName:"Engineering/BackEnd/Features",slug:"/Engineering/BackEnd/Features/MaintenanceWindows",permalink:"/va-mobile-app/docs/Engineering/BackEnd/Features/MaintenanceWindows",draft:!1,tags:[],version:"current",frontMatter:{title:"Maintenance Windows"},sidebar:"tutorialSidebar",previous:{title:"Custom Error Responses",permalink:"/va-mobile-app/docs/Engineering/BackEnd/Features/CustomErrorResponses"},next:{title:"Push Notifications",permalink:"/va-mobile-app/docs/Engineering/BackEnd/Features/PushNotifications"}},c={},d=[{value:"Overview",id:"overview",level:2},{value:"Back-end",id:"back-end",level:2},{value:"Front-end",id:"front-end",level:2}],l={toc:d},p="wrapper";function m(e){let{components:n,...t}=e;return(0,i.yg)(p,(0,a.A)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,i.yg)("h2",{id:"overview"},"Overview"),(0,i.yg)("p",null,"Maintenance windows are periods of time during which specific vets-api functionality are expected to be down for maintenance. The mobile app requests this information at the beginning of new sessions and stores the data locally. If the user navigates to a page that relies on the service during the window, they will be shown a banner informing them that the data is temporarily unavailable and the app will not attempt to fetch the data."),(0,i.yg)("h2",{id:"back-end"},"Back-end"),(0,i.yg)("p",null,"Unlike most of the data used in the vets-api engine, ",(0,i.yg)("inlineCode",{parentName:"p"},"MaintenanceWindows")," come from the vets-api database and not from upstream servers. They contain the external service name, start time, and end time. Maintenance windows are added to PagerDuty by other teams, and a vets-api sidekiq job polls PagerDuty and populates MaintenanceWindow database records with the response. There is an ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/department-of-veterans-affairs/vsp-infra-application-manifests/blob/9864e007626ceb2cd5c92b8c8838af1dbb3b4b7d/apps/vets-api/prod/values.yaml#L2169"},"allow list of maintenance windows")," on GitHub that the sidekiq job uses to connect to PagerDuty and populate the maintenance windows. The mobile app requests maintenance windows via the maintenance windows controller, which searches the database for ",(0,i.yg)("inlineCode",{parentName:"p"},"MaintenanceWindow")," records that end in the future and creates a ",(0,i.yg)("inlineCode",{parentName:"p"},"ServiceGraph")," object to process those windows into a format that is more easily used by the front-end."),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"ServiceGraph")," is an abstraction that accepts a list of arguments that define a hierarchy that matches upstream services to downstream features and returns a list of upcoming ",(0,i.yg)("inlineCode",{parentName:"p"},"Mobile::MaintenanceWindow")," records that have upcoming outages. Note that ",(0,i.yg)("inlineCode",{parentName:"p"},"Mobile::MaintenanceWindows")," are different than ",(0,i.yg)("inlineCode",{parentName:"p"},"MaintenanceWindows")," but contain the same basic data with service names that are specific to mobile app features. This allows the mobile team to define its own mapping of services to features. Each argument is an array of two symbols in which the first element is an upstream service or intermediate service and the second key is either an intermediate service or the feature name that would be received by the mobile app. Intermediate services are not included in the results, only terminal nodes (i.e., second items in the array that do not match the first items of any subsequent arrays)."),(0,i.yg)("p",null,"An example ",(0,i.yg)("inlineCode",{parentName:"p"},"ServiceGraph")," instance could be something like:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-ruby"},"Mobile::V0::ServiceGraph.new(\n  %i[bgs evss],\n  %i[vet360 military_service_history],\n  %i[evss claims],\n  %i[evss direct_deposit_benefits]\n)\n")),(0,i.yg)("p",null,"This gets processed into a hierarchy like:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"{\n  bgs: [claims, direct_deposit_benefits],\n  evss: [claims, direct_deposit_benefits],\n  vet360: [military_service_history]\n}\n")),(0,i.yg)("p",null,"So if there's an upcoming maintenance window for either ",(0,i.yg)("inlineCode",{parentName:"p"},"bgs")," or ",(0,i.yg)("inlineCode",{parentName:"p"},"evss"),", the ",(0,i.yg)("inlineCode",{parentName:"p"},"ServiceGraph")," would return an array of ",(0,i.yg)("inlineCode",{parentName:"p"},"Mobile::MaintenanceWindow")," objects including start and end times for ",(0,i.yg)("inlineCode",{parentName:"p"},"claims")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"direct_deposit_benefits"),". If there's an upcoming maintenance window for ",(0,i.yg)("inlineCode",{parentName:"p"},"vet360"),", it would return mobile maintenance window data for ",(0,i.yg)("inlineCode",{parentName:"p"},"military_service_history"),". And if all three services had upcoming maintenance windows, it would return data for ",(0,i.yg)("inlineCode",{parentName:"p"},"claims"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"direct_deposit_benefits"),", and ",(0,i.yg)("inlineCode",{parentName:"p"},"military_service_history"),"."),(0,i.yg)("h2",{id:"front-end"},"Front-end"),(0,i.yg)("p",null,"See ",(0,i.yg)("a",{parentName:"p",href:"/va-mobile-app/docs/Engineering/FrontEnd/DowntimeMessages"},"front-end documentation"),". It is important to note that coordination with front-end will be required for any changes to the ",(0,i.yg)("inlineCode",{parentName:"p"},"ServiceGraph")," hierarchy in the maintenance windows controller because effort is required on the front-end to add handling for new maintenance windows within the mobile app."))}m.isMDXComponent=!0},15680:(e,n,t)=>{t.d(n,{xA:()=>l,yg:()=>h});var a=t(96540);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var c=a.createContext({}),d=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},l=function(e){var n=d(e.components);return a.createElement(c.Provider,{value:n},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=d(t),u=i,h=p["".concat(c,".").concat(u)]||p[u]||m[u]||r;return t?a.createElement(h,o(o({ref:n},l),{},{components:t})):a.createElement(h,o({ref:n},l))}));function h(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=u;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s[p]="string"==typeof e?e:i,o[1]=s;for(var d=2;d<r;d++)o[d]=t[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},41873:(e,n,t)=>{t(96540)}}]);