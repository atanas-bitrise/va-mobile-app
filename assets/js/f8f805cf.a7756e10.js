"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[3657],{47548:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var a=t(58168),i=(t(96540),t(15680));t(41873);const r={title:"Devops"},o=void 0,l={unversionedId:"Engineering/BackEnd/Architecture/Devops",id:"Engineering/BackEnd/Architecture/Devops",title:"Devops",description:"When storing sensitive information that cannot be publicly exposed. It must be added to all the following locations:",source:"@site/docs/Engineering/BackEnd/Architecture/Devops.md",sourceDirName:"Engineering/BackEnd/Architecture",slug:"/Engineering/BackEnd/Architecture/Devops",permalink:"/va-mobile-app/docs/Engineering/BackEnd/Architecture/Devops",draft:!1,tags:[],version:"current",frontMatter:{title:"Devops"},sidebar:"tutorialSidebar",previous:{title:"Continuous Integration and Deployment",permalink:"/va-mobile-app/docs/Engineering/BackEnd/Architecture/ContinuousIntegrationAndDeployment"},next:{title:"Directory Layout",permalink:"/va-mobile-app/docs/Engineering/BackEnd/Architecture/DirectoryLayout"}},s={},p=[{value:"AWS",id:"aws",level:2},{value:"Manifests Repo",id:"manifests-repo",level:2},{value:"Devops Repo",id:"devops-repo",level:2},{value:"Adding Local Settings",id:"adding-local-settings",level:2},{value:"Forward Proxy",id:"forward-proxy",level:2}],c={toc:p},d="wrapper";function u(e){let{components:n,...t}=e;return(0,i.yg)(d,(0,a.A)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,i.yg)("p",null,"When storing sensitive information that cannot be publicly exposed. It must be added to all the following locations:"),(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"All Devops and Manifests PRs will need a Platform support ticket created for devops team to review.")),(0,i.yg)("h2",{id:"aws"},"AWS"),(0,i.yg)("p",null,"All variables should first be put in AWS. If it is not done first, when Manifests repo looks for the new variables, it will fail deployment if it is not found. This can be done at ",(0,i.yg)("a",{parentName:"p",href:"https://dsvagovcloud.signin.amazonaws-us-gov.com/console"},"AWS")," with the following steps:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Login and find service ",(0,i.yg)("inlineCode",{parentName:"li"},"Systems Manager")),(0,i.yg)("li",{parentName:"ul"},"Goto ",(0,i.yg)("inlineCode",{parentName:"li"},"Parameter Store")," in left column"),(0,i.yg)("li",{parentName:"ul"},"In search bar, type in ",(0,i.yg)("inlineCode",{parentName:"li"},"mobile")," and use other mobile keys and urls as reference to how to format new ones. The path need to match exactly what is added to Manifests.")),(0,i.yg)("h2",{id:"manifests-repo"},"Manifests Repo"),(0,i.yg)("p",null,"Once AWS has the variable, add it to the ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/department-of-veterans-affairs/vsp-infra-application-manifests"},"vsp-infra-application-manifests repo")," in the following locations:"),(0,i.yg)("p",null,(0,i.yg)("inlineCode",{parentName:"p"},"apps/vets-api/staging/templates/secrets.yaml"),": This file maps the AWS path to a variable name."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"- key: /dsva-vagov/vets-api/prod/mobile_lighthouse_letters/api_url\n  name: mobile_lighthouse_letters_api_url\n")),(0,i.yg)("p",null,(0,i.yg)("inlineCode",{parentName:"p"},"apps/vets-api/staging/values.yaml"),": This file needs two additions: mapping that name from ",(0,i.yg)("inlineCode",{parentName:"p"},"secrets.yaml")," to an env variables and fetching env variable."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"- name: mobile_lighthouse_letters_api_url\n  path: /dsva-vagov/vets-api/prod/mobile_lighthouse_letters/api_url\n  env_var: MOBILE_LIGHTHOUSE_LETTERS_API_URL\n")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"mobile_lighthouse_letters:\n  api_url: <%= ENV['MOBILE_LIGHTHOUSE_LETTERS_API_URL'] %>\n")),(0,i.yg)("p",null,"Repeat these steps for the production files in ",(0,i.yg)("inlineCode",{parentName:"p"},"apps/vets-api/prod"),". Dev env is not used by mobile and does not need to be added there."),(0,i.yg)("h2",{id:"devops-repo"},"Devops Repo"),(0,i.yg)("p",null,"If you'd like to use these values in review instances, after updating Manifests repo, add the variables to ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/department-of-veterans-affairs/devops"},"devops repo")," in ",(0,i.yg)("inlineCode",{parentName:"p"},"ansible/roles/review-instance-configure/vars/settings.local.yml")),(0,i.yg)("h2",{id:"adding-local-settings"},"Adding Local Settings"),(0,i.yg)("p",null,"Add a new section to ",(0,i.yg)("inlineCode",{parentName:"p"},"config/settings.yml")," in the vets-api. See mobile entry ",(0,i.yg)("inlineCode",{parentName:"p"},"lighthouse_health_immunization")," as reference."),(0,i.yg)("p",null,"This file populates these variables in local spec environment. Variables will get overwritten by the Devops/Manifest values in staging and production."),(0,i.yg)("p",null,"The names of the variables should be identical to what is in Devops/Manifests repos but the values can be dummy values. They can then be referenced by ",(0,i.yg)("inlineCode",{parentName:"p"},"Settings")," variable in specs."),(0,i.yg)("h2",{id:"forward-proxy"},"Forward Proxy"),(0,i.yg)("p",null,"If updating forward proxies to a URL is necessary, this can be done at ",(0,i.yg)("inlineCode",{parentName:"p"},"ansible/deployment/config, fwdproxy-vagov-staging.yml"),", and ",(0,i.yg)("inlineCode",{parentName:"p"},"ansible/deployment/config/fwdproxy-vagov-prod.yml")))}u.isMDXComponent=!0},15680:(e,n,t)=>{t.d(n,{xA:()=>c,yg:()=>m});var a=t(96540);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},g=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(t),g=i,m=d["".concat(s,".").concat(g)]||d[g]||u[g]||r;return t?a.createElement(m,o(o({ref:n},c),{},{components:t})):a.createElement(m,o({ref:n},c))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=g;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[d]="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}g.displayName="MDXCreateElement"},41873:(e,n,t)=>{t(96540)}}]);